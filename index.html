<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8" />
      <title>Supermarkets</title>

      <!-- Remember to edit the CSS so that your result looks similar
      to expectedresult.png -->
      <link rel="stylesheet" href="_css/hw1.css">

      <script src="_js/jquery-1.11.0.min.js"></script>
      <script src="_js/highcharts.js"></script>
  </head>

  <body>

    <div id="wrapper">
      <h3>Markets Shiz... by Peter Rowland & Steve Trush</h3>

      <!-- Revenue Growth by State -->
      <div id="chart-rev-ca"> </div>
      <div id="chart-rev-tx"> </div>
      <div id="chart-rev-or"> </div>

      <!-- Transactions / Traffic by State -->
      <div id="chart-tandt-ca", class="chart-800"> </div>
      <div id="chart-tandt-tx", class="chart-800"> </div>
      <div id="chart-tandt-or", class="chart-800"> </div>

    </div>

    <script>

    $(function () {
      Highcharts.setOptions({
        chart: {
          style: {
            fontFamily: "Helvetica,Arial,sans-serif"
          }
        },
        legend: {
          borderRadius: 0,
          itemStyle: {
            color: "#000000",
            fontFamily: "Helvetica,Arial,sans-serif"
          }
        },
        title: {
          style: {
            color: "#000000",
            fontFamily: "Helvetica,Arial,sans-serif",
            fontSize: "20px",
            fontWeight: "bold"
          }
        },
        tooltip: {
          borderRadius: 5,
          borderWidth: 1,
          shadow: true,

          style: {
            color: "#333333",
            fontFamily: "Arial, sans-serif",
            fontSize: "14px",
            padding: "10px"
          }
        },
        xAxis: {
          labels: {
            style: {
              color: "#333333",
              fontFamily: "Helvetica,Arial,sans-serif",
              fontSize: "10px"
            }
          },
        },
        yAxis: {
          labels: {
            style: {
              color: "#333333",
              fontFamily: "Helvetica,Arial,sans-serif",
              fontSize: "10px"
            }
          }
        }
      })
    });

    // Revenue Charts Options
    var revOptions = {
      xAxis: {
        categories: ['2011', '2012', '2013', '2014', '2015']
      },
      yAxis: {
	      tickInterval: 5,
	  		max: 30,
	  		min: -31,
			  plotLines: [{
			    value: 0,
			    width: 1,
			    color: "#808080"
			  }],
      },
      tooltip: {
        valueSuffix: '%'
      },
      legend: {
        layout: 'vertical',
        align: 'right',
        //verticalAlign: 'middle',
        borderWidth: 0
      },
    };

    // Transactions Charts Options
    var ttOptions = {
    	xAxis: {
				categories: ['2011', '2012', '2013', '2014', '2015']
    	},
      yAxis: {
	      //tickInterval: 5,
	  		min: 0,
			  plotLines: [{
			    value: 0,
			    width: 1,
			    color: "#808080"
			  }],
      },
    };

    var chartRevCa = {
        title: {
          text: "Revenue Growth in California"
        },
        yAxis: {
        	title: {
            text: 'Change in Revenue from Previous Year (%)'
        	},
        },
        chart: {
          renderTo: "chart-rev-ca",
          type: "line"
        },
        series: []
    };
    var chartRevTx = {
        title: {
          text: "Revenue Growth in Texas"
        },
        yAxis: {
        	title: {
          	text: 'Change in Revenue from Previous Year (%)'
        	},
        },
        chart: {
          renderTo: "chart-rev-tx",
          type: "line"
        },
        series: []
    };
    var chartRevOr = {
        title: {
        	text: "Revenue Growth in Oregon"
        },
        yAxis: {
        	title: {
          	text: 'Change in Revenue from Previous Year (%)'
        	},
        },

        chart: {
          renderTo: "chart-rev-or",
          type: "line"
      	},
      	series: []
    };

    // -----

    var chartTandtCa = {
      title: {
        text: "Transactions and Traffic in California"
      },
      yAxis: {
      	title: {
      		text: 'Volume (in millions)'
      	}
      },
      plotOptions: {
        column: {
          stacking: "normal" // vs. "percent"
        }
      },
      chart: {
        renderTo: "chart-tandt-ca",
        type: "column"
      },
      series: []
    };

    var chartTandtTx = {
      title: {
        text: "Transactions and Traffic in Texas"
      },
      yAxis: {
      	title: {
      		text: 'Volume (in millions)'
      	}
      },
      plotOptions: {
        series: {
          stacking: "normal" // vs. "percent"
        }
      },
      chart: {
        renderTo: "chart-tandt-tx",
        type: "column"
      },
      series: []
    };

    var chartTandtOr = {
      title: {
        text: "Transactions and Traffic in Oregon"
      },
      yAxis: {
      	title: {
      		text: 'Volume (in millions)'
      	}
      },
      plotOptions: {
        series: {
          stacking: "normal" // vs. "percent"
        }
      },
      chart: {
        renderTo: "chart-tandt-or",
        type: "column"
      },
      series: []
    };

    // Color Picker
    function colors(i) {
      switch(i) {
        case 0:
          return "#f05555"; // walmart
          break;
        case 1:
          return "#1bdb1b"; // safeway
          break;
        case 2:
          return "#4545ff"; // whole foods
          break;
        case 3:
          return "#d030d0"; // target
          break;
        case 4:
          return "#d6ea3b"; // safeway
          break;
        case 5:
          return "#AAAAAA"; // whole foods
          break;
        case 6:
          return "#ff8319"; // target
      };
    };

    $.get("_data/supermarkets.csv", function(data) {

    	// Common
      var lines = data.split('\n');
      var storenames = [
      	"Walmart",
      	"Safeway",
      	"Whole Foods",
      	"Target",
      	"Costco",
      	"Kmart",
      	"Trader Joes"
      ];

      var stores = {
      	"Walmart":0,
      	"Safeway":1,
      	"Whole Foods":2,
      	"Target":3,
      	"Costco":4,
      	"Kmart":5,
      	"Trader Joes":6
      };

      var states = {
      	"California":0,
      	"Texas":1,
      	"Oregon":2
      };

      // Revenue Variable
      var revByStore = new Array(7);
      for (var i = 0; i < revByStore.length; i++){
        revByStore[i] = [[],[],[]];
      }

      // Transaction / Traffic Variables
      // [0] = items[3], [1] = items[4]
      var transTraffByStore = new Array(7);
			for (var i = 0; i < revByStore.length; i++){
			  transTraffByStore[i] = [ [[], []], [[], []], [[], []] ];
			}

      $.each(lines, function(index,value) {
        var lineNo = index;
        var line = value;
        var items = line.split(",");

        // Header, ignore
        if (lineNo == 0) {

        // Rows, data
        } else {
          var store = stores[items[0]];
          var state = states[items[1]];
          revByStore[store][state].push(parseFloat(items[6]));
          transTraffByStore[store][state][0].push(parseFloat(items[3]));
          transTraffByStore[store][state][1].push(parseFloat(items[4]));

         }; // /else
       }); // /$.each()

      	// Push Data to Chart Objects
        // CA Revenue
        for(var i = 0; i < revByStore.length; i++) {
           var chartRevCaData = {
                name: storenames[i],
                data: revByStore[i][0],
                color: colors(i),
                index: revByStore.length - 1 - i,
                legendIndex: i
            };
            chartRevCa.series.push(chartRevCaData);
        };

        // TX Revenue
        for(var i = 0; i < revByStore.length; i++) {
           var chartRevTxData = {
                name: storenames[i],
                data: revByStore[i][1],
                color: colors(i),
                index: revByStore.length - 1 - i,
                legendIndex: i
            };

            chartRevTx.series.push(chartRevTxData);
        };

				// OR Revenue
        for(var i = 0; i < revByStore.length; i++) {
           var chartRevOrData = {
                name: storenames[[i]],
                data: revByStore[i][2],
                color: colors(i),
                index: revByStore.length - 1 - i,
                legendIndex: i
            };
            chartRevOr.series.push(chartRevOrData);
        };

        // CA Traffic
				for(var i = 0; i < transTraffByStore.length; i++) {
           var chartTransCaData = {
                name: storenames[[i]] + " Transactions",
                data: transTraffByStore[i][0][0],
                stack: storenames[[i]] + " Transactions",
                color: colors(i),
                index: transTraffByStore.length - 1 - i,
                legendIndex: i
            };
            chartTandtCa.series.push(chartTransCaData);

            var chartTrafCaData = {
                 name: storenames[[i]] + " Traffic",
                 data: transTraffByStore[i][0][1],
                 stack: storenames[[i]],
                 color: colors(i),
                 index: transTraffByStore.length - 1 - i,
                 legendIndex: i
            };
            chartTandtCa.series.push(chartTrafCaData);
          };

          // TX Traffic
  				for(var i = 0; i < transTraffByStore.length; i++) {
             var chartTransTxData = {
                  name: storenames[[i]] + " Transactions",
                  data: transTraffByStore[i][1][0],
                  stack: storenames[[i]] + " Transactions",
                  color: colors(i),
                  index: transTraffByStore.length - 1 - i,
                  legendIndex: i
              };
              chartTandtTx.series.push(chartTransTxData);

              var chartTrafTxData = {
                   name: storenames[[i]] + " Traffic",
                   data: transTraffByStore[i][1][1],
                   stack: storenames[[i]],
                   color: colors(i),
                   index: transTraffByStore.length - 1 - i,
                   legendIndex: i
              };
              chartTandtTx.series.push(chartTrafTxData);
            };

            // OR Traffic
    				for(var i = 0; i < transTraffByStore.length; i++) {
               var chartTransOrData = {
                    name: storenames[[i]] + " Transactions",
                    data: transTraffByStore[i][2][0],
                    stack: storenames[[i]] + " Transactions",
                    color: colors(i),
                    index: transTraffByStore.length - 1 - i,
                    legendIndex: i
                };
                chartTandtOr.series.push(chartTransOrData);

                var chartTrafOrData = {
                     name: storenames[[i]] + " Traffic",
                     data: transTraffByStore[i][2][1],
                     stack: storenames[[i]],
                     color: colors(i),
                     index: transTraffByStore.length - 1 - i,
                     legendIndex: i
                };
                chartTandtOr.series.push(chartTrafOrData);
              };


      // Chart Objects
      chartRevCa = jQuery.extend(true, {}, revOptions, chartRevCa);
      var chart1 = new Highcharts.Chart(chartRevCa);

      chartRevTx = jQuery.extend(true, {}, revOptions, chartRevTx);
      var chart2 = new Highcharts.Chart(chartRevTx);

      chartRevOr = jQuery.extend(true, {}, revOptions, chartRevOr);
      var chart3 = new Highcharts.Chart(chartRevOr);

      chartTandtCa = jQuery.extend(true, {}, ttOptions, chartTandtCa);
      var chart4 = new Highcharts.Chart(chartTandtCa);

      chartTandtTx = jQuery.extend(true, {}, ttOptions, chartTandtTx);
      var chart5 = new Highcharts.Chart(chartTandtTx);

      chartTandtOr = jQuery.extend(true, {}, ttOptions, chartTandtOr);
      var chart6 = new Highcharts.Chart(chartTandtOr);

		//Debug
    console.log(revByStore);
    console.log(chartTandtCa);

    }); // /.get()




    </script>

  </body>

</html>
